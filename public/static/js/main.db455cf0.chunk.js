(this["webpackJsonptsuyu-web"]=this["webpackJsonptsuyu-web"]||[]).push([[0],{100:function(e,t,s){},101:function(e,t,s){"use strict";s.r(t);var a,r=s(1),i=s.n(r),o=s(32),c=s.n(o),n=(s(41),s(11)),l=s(4),d=s(6);const u=new(Object(d.c)({name:"settings",idKey:"_id"})(a=class extends d.b{constructor(){super({})}})||a);class h extends d.a{constructor(e){super(e),this.store=e,this.maxFileSizeBytes$=this.select((e=>e.max_file_size_bytes)),this.registerEnabled$=this.select((e=>e.register_enabled)),this.isLoading$=this.selectLoading(),this.error$=this.selectError()}}const b=new h(u);var j,g=s(13),m=s.n(g);const p=new(Object(d.c)({name:"user",idKey:"_id"})(j=class extends d.b{constructor(){super({})}})||j);class O extends d.a{constructor(e){super(e),this.store=e,this.user$=this.select(),this.isLoggedIn$=this.select((e=>!!e.api_key)),this.api_key=this.select((e=>e.api_key)),this.isLoading$=this.selectLoading(),this.error$=this.selectError()}}const x=new O(p);const v=new class{constructor(e){this.store=e}async login(e){this.store.setLoading(!0),this.store.setError(""),this.store.update({message:void 0});try{const t=await N("login","POST",e);200===t.status?this.store.update({...t.json}):this.store.setError("Invalid username or password.")}catch(t){this.store.setError(t.message)}this.store.setLoading(!1)}async register(e){this.store.setLoading(!0),this.store.setError("");try{const t=await N("register","POST",e);200===t.status?this.store.update({...t.json}):this.store.setError(t.error)}catch(t){this.store.setError(t.message)}this.store.setLoading(!1)}logout(){this.store.update({id:void 0,username:void 0,email:void 0,api_key:void 0,is_admin:void 0,last_update:void 0,created_at:void 0,message:void 0})}async changePassword(e){this.store.setLoading(!0),this.store.setError(""),this.store.update({message:void 0});const t=this.store.getValue();try{const s=await N("change-password","POST",e,[t.id.toString()]);200===s.status?this.store.update({message:"Successfully updated password"}):this.store.setError(s.error)}catch(s){this.store.setError(s.message)}this.store.setLoading(!1)}}(p),f=()=>{const[e,t]=Object(r.useState)(!1),[s,a]=Object(r.useState)(""),[i,o]=Object(r.useState)(),[c,n]=Object(r.useState)(!1);return Object(r.useEffect)((()=>{const e=[x.isLoading$.subscribe((e=>t(e))),x.error$.subscribe((e=>a(e))),x.user$.subscribe((e=>o(e))),x.isLoggedIn$.subscribe((e=>n(e)))];return()=>{e.map((e=>e.unsubscribe()))}}),[]),{isLoggedIn:c,user:i,error:s,isLoading:e}},w="https://u.tro.moe";let y="";async function N(e,t,s,a){let r,i="".concat(w,"/").concat(e);if(void 0!==a)for(const n of a)i+="/".concat(n);try{var o;r=await m()({method:t,url:i,data:s,headers:{"Content-Type":"application/json",Authorization:null!==(o=y)&&void 0!==o?o:""}})}catch(c){const e=c;if(!e.response)throw new Error("Request failed");r=e.response}return 200===r.status?{status:200,json:r.data}:{status:r.status,json:r.data,error:r.data}}x.api_key.subscribe((e=>{y=e}));const L=new class{constructor(e){this.store=e}async fetchSettings(){this.store.setLoading(!0),this.store.setError("");const e=await N("settings","GET");200===e.status?this.store.update({...e.json}):this.store.setError("Invalid username or password."),this.store.setLoading(!1)}}(u);s(61);var P=s(18),E=s.n(P),S=s(0);var k=e=>{let t="button";return e.small&&(t+=" button-small"),e.transparent&&(t+=" button-transparent"),Object(S.jsx)("button",{className:"".concat(t," ").concat(e.className),type:e.type,onClick:()=>{var t;return null===(t=e.onClick)||void 0===t?void 0:t.call(e)},disabled:e.isLoading,children:e.isLoading?Object(S.jsx)(E.a,{color:"#000000",size:8}):e.text})};s(67);var C=e=>Object(S.jsxs)("div",{style:{width:"100%"},children:[e.label&&Object(S.jsx)("label",{className:"input-label",htmlFor:e.id,children:e.label}),Object(S.jsx)("input",{className:"text-input",id:e.id,type:e.type,placeholder:e.placeholder,onChange:t=>e.onChange?e.onChange(t.target.value):null,disabled:e.disabled})]});s(68);var _=e=>{const[t,s]=Object(r.useState)(""),[a,i]=Object(r.useState)(""),[o,c]=Object(r.useState)(""),[n,l]=Object(r.useState)("login");let d=0,u=0;if(e.anchorElement){const{innerWidth:t}=window,s=e.anchorElement.getBoundingClientRect();d=t-s.right+20,u=s.bottom+20}return Object(S.jsxs)("form",{className:"login-popup",style:{right:d,top:u},onSubmit:s=>{e.isLoading||(null===s||void 0===s||s.preventDefault(),"login"===n?v.login({username:t,password:a}):v.register({username:t,password:a,email:o}))},children:[Object(S.jsx)("div",{className:"popup-arrow"}),Object(S.jsx)("label",{className:"login-error",children:e.error}),Object(S.jsx)(C,{id:"username",placeholder:"Username",onChange:e=>s(e)}),Object(S.jsx)(C,{id:"password",placeholder:"Password",type:"password",onChange:e=>i(e)}),"register"===n?Object(S.jsx)(C,{id:"email",placeholder:"Email",type:"email",onChange:e=>c(e)}):null,Object(S.jsxs)("div",{className:"login-buttons",children:[e.showRegister&&"login"===n&&Object(S.jsx)(k,{type:"button",onClick:()=>l("register"),small:!0,transparent:!0,text:"Create account"}),e.showRegister&&"register"===n&&Object(S.jsx)(k,{type:"button",onClick:()=>l("login"),small:!0,transparent:!0,text:"Already have an account?"}),Object(S.jsx)(k,{text:"login"===n?"Log In":"Register",isLoading:e.isLoading})]})]})};s(69);var F=e=>{const{isLoggedIn:t,error:s,isLoading:a}=f(),{register_enabled:i}=(()=>{const[e,t]=Object(r.useState)(!1),[s,a]=Object(r.useState)(""),[i,o]=Object(r.useState)(!1),[c,n]=Object(r.useState)(0);return Object(r.useEffect)((()=>{L.fetchSettings();const e=[b.isLoading$.subscribe((e=>t(e))),b.error$.subscribe((e=>a(e))),b.registerEnabled$.subscribe((e=>o(e))),b.maxFileSizeBytes$.subscribe((e=>n(e)))];return()=>{e.map((e=>e.unsubscribe()))}}),[]),{register_enabled:i,max_file_size_bytes:c,error:s,isLoading:e}})(),o=Object(r.useRef)(),[c,l]=Object(r.useState)(!1);return Object(r.useEffect)((()=>{l(!1)}),[t]),Object(S.jsxs)("nav",{className:"nav-bar",children:[Object(S.jsx)("section",{className:"nav-start",children:Object(S.jsx)("h3",{className:"name",children:"tsuyu"})}),Object(S.jsxs)("section",{className:"nav-end",children:[Object(S.jsx)(n.b,{to:"",className:"home"===e.activePage?"nav-item active":"nav-item",children:"Home"}),Object(S.jsx)(n.b,{to:"contact",className:"contact"===e.activePage?"nav-item active":"nav-item",children:"Contact"}),t?Object(S.jsx)(n.b,{to:"dashboard",className:"dashboard"===e.activePage?"nav-item active":"nav-item",children:"Dashboard"}):Object(S.jsx)("button",{className:"nav-item",onClick:()=>l(!c),ref:e=>o.current=e,children:"Log in"})]}),c?Object(S.jsx)(_,{anchorElement:o.current,showRegister:i,error:s,isLoading:a}):null]})};s(75);var $,U=()=>Object(S.jsx)(S.Fragment,{children:Object(S.jsx)("section",{className:"route",id:"contact",children:Object(S.jsxs)("section",{className:"contact",children:[Object(S.jsx)("h1",{className:"contact-title",children:"Contact"}),Object(S.jsxs)("p",{className:"contact-info",children:["For legal notices or takedown requests, please go contact me via ",Object(S.jsx)("a",{href:"mailto:filip.ekstrom98@gmail.com",className:"link",children:"email."})]}),Object(S.jsxs)("p",{className:"contact-info",children:["For other questions and answers, be sure to contact me either via ",Object(S.jsx)("a",{href:"mailto:filip.ekstrom98@gmail.com",className:"link",children:"email"})," or by joining my ",Object(S.jsx)("a",{href:"https://discord.gg/roost",className:"link",children:"Discord Server."})]})]})})}),T=s(20);s(76);const z=new(Object(d.c)({name:"files",idKey:"_id"})($=class extends d.b{constructor(){super({currentPage:1,totalPages:1,files:[]})}})||$);class I extends d.a{constructor(e){super(e),this.store=e,this.files$=this.select((e=>e.files)),this.recentlyUploaded$=this.select((e=>e.recentlyUploaded)),this.uploadProgress$=this.select((e=>e.uploadProgress)),this.currentPage$=this.select((e=>e.currentPage)),this.totalPages$=this.select((e=>e.totalPages)),this.isLoading$=this.selectLoading(),this.error$=this.selectError()}}const R=new I(z);const B=new class{constructor(e,t){this.store=e,this.userStore=t}async getFileCount(){this.store.setLoading(!0),this.store.setError("");try{const s=await N("file-count","GET");var e,t;if(200===s.status)this.store.update({totalPages:Math.ceil((null!==(e=null===(t=s.json)||void 0===t?void 0:t.num_count)&&void 0!==e?e:.1)/12)});else this.store.setError(s.error)}catch(s){this.store.setError(s.message)}this.store.setLoading(!1)}async getFiles(){this.store.setLoading(!0),this.store.setError("");const e=this.store.getValue();try{const t=await N("files","GET",void 0,[e.currentPage.toString()]);200===t.status?this.store.update({files:t.json}):this.store.setError(t.error)}catch(t){this.store.setError(t.message)}this.store.setLoading(!1)}async getNextPage(){const e=this.store.getValue();e.currentPage>=e.totalPages||(this.store.update({currentPage:e.currentPage+1}),await this.getFiles())}async getPreviousPage(){const e=this.store.getValue();e.currentPage<=1||(this.store.update({currentPage:e.currentPage-1}),await this.getFiles())}async uploadFile(e){this.store.setLoading(!0),this.store.setError("");const t=this.userStore.getValue(),s=this.store.getValue();try{let i;try{let s=new FormData;s.append("file",e),i=await m.a.post("".concat(w,"/upload"),s,{headers:{"Content-Type":"multipart/form-data",Authorization:t.api_key},onUploadProgress:e=>{const t=Math.round(e.loaded/e.total*100);this.store.update({uploadProgress:t})}})}catch(r){const e=r;if(!e.response)throw new Error("Request failed");i=e.response}var a;if(200===i.status)this.store.update({uploadProgress:0,recentlyUploaded:[...null!==(a=s.recentlyUploaded)&&void 0!==a?a:[],i.data]});else this.store.setError(i.data)}catch(i){this.store.setError(i.message)}this.store.setLoading(!1)}}(z,p),A=()=>{const{isLoggedIn:e}=f(),[t,s]=Object(r.useState)(!1),[a,i]=Object(r.useState)(""),[o,c]=Object(r.useState)([]),[n,l]=Object(r.useState)([]),[d,u]=Object(r.useState)(0),[h,b]=Object(r.useState)(1),[j,g]=Object(r.useState)(1);return Object(r.useEffect)((()=>{e&&(B.getFileCount(),B.getFiles());const t=[R.isLoading$.subscribe((e=>s(e))),R.error$.subscribe((e=>i(e))),R.files$.subscribe((e=>c(null!==e&&void 0!==e?e:[]))),R.recentlyUploaded$.subscribe((e=>l(null!==e&&void 0!==e?e:[]))),R.uploadProgress$.subscribe((e=>u(null!==e&&void 0!==e?e:0))),R.currentPage$.subscribe((e=>b(e))),R.totalPages$.subscribe((e=>g(e)))];return()=>{t.map((e=>e.unsubscribe()))}}),[e]),{error:a,isLoading:t,files:o,recentlyUploaded:n,uploadProgress:d,currentPage:h,totalPages:j}};var D=s(105),M=s(35);var H=()=>{const e=Object(l.f)(),[t,s]=Object(r.useState)("files"),{currentPage:a,totalPages:i,files:o,isLoading:c}=A(),{user:n,error:d}=f(),[u,h]=Object(r.useState)(""),[b,j]=Object(r.useState)(""),g=()=>{v.changePassword({password:u,new_password:b})};return Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("section",{className:"route",id:"dashboard",children:[Object(S.jsxs)("nav",{className:"dashboard-menu",children:[Object(S.jsx)("button",{className:"menu-item",onClick:()=>s("files"),children:"Files"}),Object(S.jsx)("button",{className:"menu-item",onClick:()=>s("account"),children:"Account"}),Object(S.jsx)("button",{className:"menu-item",onClick:()=>{v.logout(),e.push("home"),console.info("Logged out")},children:"Log Out"})]}),Object(S.jsx)("section",{className:"dashboard-content",children:(()=>{var e;switch(t){case"files":return Object(S.jsx)("section",{className:"dashboard-files",children:c?Object(S.jsx)("div",{className:"loading",children:Object(S.jsx)(M.BounceLoader,{color:"#44E384"})}):Object(S.jsxs)(S.Fragment,{children:[Object(S.jsxs)("section",{className:"file-table",children:[Object(S.jsxs)("div",{className:"table-header",children:[Object(S.jsx)("span",{className:"header-name",children:"Original file name"}),Object(S.jsx)("span",{className:"header-size",children:"Size"}),Object(S.jsx)("span",{className:"header-date",children:"Date uploaded"}),Object(S.jsx)("span",{className:"header-link",children:"Link"})]}),Object(S.jsx)("div",{className:"table-content",children:o.map((e=>Object(S.jsxs)("div",{className:"table-row",children:[Object(S.jsx)("div",{className:"row-name",children:e.original_name}),Object(S.jsx)("div",{className:"row-size",children:Object(S.jsx)("span",{children:e.file_size>1e3?"".concat((e.file_size/1e3).toFixed(2)," MB"):"".concat(e.file_size," KB")})}),Object(S.jsx)("div",{className:"row-date",children:Object(S.jsx)("span",{children:Object(D.a)(new Date(e.created_at),"dd MMM HH:mm aaa")})}),Object(S.jsx)(k,{className:"row-link",small:!0,transparent:!0,text:"Copy",onClick:()=>{return t=e,void navigator.clipboard.writeText("".concat(w,"/").concat(t.name));var t}})]},e.id)))})]}),Object(S.jsxs)("div",{className:"table-nav",children:[Object(S.jsx)("button",{className:a<=1?"disabled":"",disabled:a<=1,onClick:()=>B.getPreviousPage(),children:Object(S.jsx)(T.a,{color:a<=1?"#5B5C5E":"#DAE1E7",size:18})}),"Page ",a,"/",i,Object(S.jsx)("button",{className:a>=i?"disabled":"",disabled:a>=i,onClick:()=>B.getNextPage(),children:Object(S.jsx)(T.b,{color:a>=i?"#5B5C5E":"#DAE1E7",size:18})})]})]})});case"account":return Object(S.jsxs)("section",{className:"dashboard-account",children:[Object(S.jsx)(C,{disabled:!0,id:"username",placeholder:null===n||void 0===n?void 0:n.username,label:"Username"}),Object(S.jsx)(C,{disabled:!0,id:"email",placeholder:null!==(e=null===n||void 0===n?void 0:n.email)&&void 0!==e?e:"",label:"Email"}),Object(S.jsxs)("div",{className:"token-input",children:[Object(S.jsx)(C,{disabled:!0,id:"token",placeholder:null===n||void 0===n?void 0:n.api_key,label:"Api Token"}),Object(S.jsx)(k,{text:"Copy",className:"token-copy",onClick:()=>(()=>{var e;navigator.clipboard.writeText(null!==(e=null===n||void 0===n?void 0:n.api_key)&&void 0!==e?e:"")})()})]}),Object(S.jsxs)("form",{className:"password-update",onSubmit:()=>g(),children:[Object(S.jsx)("label",{className:"password-update-error",children:d}),Object(S.jsx)("label",{className:"password-update-success",children:null===n||void 0===n?void 0:n.message}),Object(S.jsx)(C,{id:"oldpass",label:"Old password",type:"password",onChange:e=>h(e)}),Object(S.jsx)(C,{id:"newpass",label:"New Password",type:"password",onChange:e=>j(e)}),Object(S.jsx)(k,{text:"Update password",type:"button",onClick:()=>g()})]})]})}})()})]})})};s(99);var V=e=>{var t;return Object(S.jsxs)("div",{className:"upload-button-wrapper",children:[Object(S.jsx)("input",{type:"file",id:"upload-button",name:"files",style:{display:"none"},onChange:t=>{var s,a;return null===(s=e.onUpload)||void 0===s?void 0:s.call(e,null===(a=t.target.files)||void 0===a?void 0:a[0])},multiple:!1,disabled:0!==e.percentage}),Object(S.jsx)("label",{htmlFor:"upload-button",id:"upload-label",className:"upload-label",progress:"50px",children:"Click or drag file to upload"}),Object(S.jsx)("div",{className:"upload-progress",style:{width:"".concat(null!==(t=e.percentage)&&void 0!==t?t:0,"%")}})]})},q=s(36),G=s.n(q);s(100);const K={Version:"1.0",Name:"tsuyu",DestinationType:"ImageUploader, TextUploader, FileUploader",RequestMethod:"POST",RequestURL:"".concat("https://u.tro.moe","/upload"),Headers:{Authorization:"REPLACE_THIS"},Body:"MultipartFormData",FileFormName:"file",URL:"$response$"};var J=()=>{const{isLoggedIn:e,user:t}=f(),{recentlyUploaded:s,uploadProgress:a}=A(),r=()=>{const e={...K};var s;null!==t&&void 0!==t&&t.api_key&&(e.Headers.Authorization=null!==(s=null===t||void 0===t?void 0:t.api_key)&&void 0!==s?s:"");const a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});G()(a,"tsuyu.sxcu","application/json")},i=e=>{e&&B.uploadFile(e)};return Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("section",{className:"route",id:"home",children:[Object(S.jsxs)("section",{className:"info",children:[Object(S.jsx)("h1",{className:"title",children:"tsuyu"}),Object(S.jsx)("h3",{className:"subtitle",children:"\u30c4\u30e6"}),Object(S.jsx)("p",{className:"description",children:"File uploading service."})]}),Object(S.jsx)("section",{className:"interactions",children:e?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(V,{onUpload:i,percentage:a}),(null===s||void 0===s?void 0:s.length)>0&&Object(S.jsx)("h4",{children:"Uploaded files (Last 3)"}),[...s].reverse().slice(0,3).map((e=>Object(S.jsxs)("div",{className:"recent-file",children:[Object(S.jsx)(k,{text:"Copy URL",onClick:()=>(e=>{navigator.clipboard.writeText(e)})(e),small:!0}),Object(S.jsx)("span",{children:e.split("".concat(window.location.host,"/"))[1]})]},e))),Object(S.jsxs)("div",{className:"interaction-buttons",children:[Object(S.jsx)(k,{text:"Github",className:"button-github",onClick:()=>window.location.href="https://github.com/tromodolo/tsuyu"}),Object(S.jsx)(k,{text:"ShareX config",className:"button-sharex",onClick:()=>r()})]})]}):Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("div",{className:"interaction-buttons wide",children:[Object(S.jsx)(k,{text:"Github",className:"button-github",onClick:()=>window.location.href="https://github.com/tromodolo/tsuyu"}),Object(S.jsx)(k,{text:"ShareX config",className:"button-sharex",onClick:()=>r()})]})})}),Object(S.jsx)("a",{className:"credits",href:"https://www.pixiv.net/en/artworks/71865345",children:"Art source: Hang"})]})})};var X=()=>{const{isLoggedIn:e}=f();return Object(S.jsx)(n.a,{children:Object(S.jsxs)(l.c,{children:[Object(S.jsx)(l.a,{path:"/contact",children:Object(S.jsxs)("main",{className:"content",children:[Object(S.jsx)(F,{activePage:"contact"}),Object(S.jsx)(U,{})]})}),e?Object(S.jsx)(l.a,{path:"/dashboard",children:Object(S.jsxs)("main",{className:"content",children:[Object(S.jsx)(F,{activePage:"dashboard"}),Object(S.jsx)(H,{})]})}):null,Object(S.jsx)(l.a,{path:"/",children:Object(S.jsxs)("main",{className:"content",children:[Object(S.jsx)(F,{activePage:"home"}),Object(S.jsx)(J,{})]})})]})})};Object(d.d)({include:["user"]});var W=function(){return Object(S.jsx)(X,{})};var Q=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,106)).then((t=>{let{getCLS:s,getFID:a,getFCP:r,getLCP:i,getTTFB:o}=t;s(e),a(e),r(e),i(e),o(e)}))};c.a.render(Object(S.jsx)(i.a.StrictMode,{children:Object(S.jsx)(W,{})}),document.getElementById("root")),Q()},41:function(e,t,s){},61:function(e,t,s){},67:function(e,t,s){},68:function(e,t,s){},69:function(e,t,s){},75:function(e,t,s){},76:function(e,t,s){},99:function(e,t,s){}},[[101,1,2]]]);
//# sourceMappingURL=main.db455cf0.chunk.js.map